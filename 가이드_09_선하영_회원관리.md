# ğŸ“˜ ê°€ì´ë“œ_09_ì„ í•˜ì˜_íšŒì›ê´€ë¦¬ (ì‹¬í™”)

> **ìƒíƒœ ì§„ë‹¨**: í˜„ì¬ `board-project`ì— íŒŒì¼ì€ ìƒì„±ë˜ì–´ ìˆìœ¼ë‚˜, **ë‚´ìš©ì´ ë¹„ì–´ìˆê±°ë‚˜(TODO)** í•µì‹¬ ë¡œì§ì´ êµ¬í˜„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
> **ëª©í‘œ**: ë¹ˆ ê»ë°ê¸°ì¸ Action í´ë˜ìŠ¤ë“¤ì„ ì‹¤ì œ ì‘ë™í•˜ëŠ” ì½”ë“œë¡œ ì±„ì›Œë„£ê¸°

---

## 1. ï¿½ `LoginAction.java` êµ¬í˜„ (í˜„ì¬ ë¹„ì–´ìˆìŒ!)

í˜„ì¬ `src/main/java/com/saeyan/controller/action/member/LoginAction.java` íŒŒì¼ì„ ì—´ì–´ë³´ë©´ `TODO`ë§Œ ìˆê³  ë¹„ì–´ìˆìŠµë‹ˆë‹¤. ì•„ë˜ ì½”ë“œë¡œ **ì „ì²´ ë®ì–´ì“°ê¸°** í•˜ì„¸ìš”.

**í•µì‹¬ ë³€ê²½ì **:
- ê¸°ì¡´ `LoginServlet`ì˜ ë¡œì§ì„ ê°€ì ¸ì˜¤ë˜,
- **ì„¸ì…˜(Session)**ì— `userId`, `userName`, `userRole` 3ê°€ì§€ë¥¼ ë°˜ë“œì‹œ ì €ì¥í•´ì•¼ í•©ë‹ˆë‹¤.

```java
package com.saeyan.controller.action.member;

import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import com.saeyan.controller.action.Action;
import com.saeyan.dao.MemberDAO;
import com.saeyan.dto.MemberVO;

public class LoginAction implements Action {

    @Override
    public String execute(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
            
        String url = "member/login_fail.jsp";
        String id = request.getParameter("id");
        String pwd = request.getParameter("pwd");

        MemberDAO dao = MemberDAO.getInstance();
        
        // 1. íšŒì› ì¸ì¦ (1: ì„±ê³µ, 0: ë¹„ë²ˆí‹€ë¦¼, -1: ì•„ì´ë””ì—†ìŒ)
        int result = dao.userCheck(id, pwd);

        if (result == 1) {
            // 2. ë¡œê·¸ì¸ ì„±ê³µ ì‹œ íšŒì› ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            MemberVO vo = dao.getMember(id);
            
            // 3. ì„¸ì…˜ì— í•µì‹¬ ì •ë³´ ì €ì¥ (íŒ€ì› ê³µí†µ ì•½ì†!)
            HttpSession session = request.getSession();
            session.setAttribute("userId", vo.getId());
            session.setAttribute("userName", vo.getName());
            session.setAttribute("userRole", vo.getRole()); // ê´€ë¦¬ì/ì¼ë°˜ êµ¬ë¶„ìš©
            
            // 4. ê´€ë¦¬ìë¼ë©´ ê´€ë¦¬ì í˜ì´ì§€ë¡œ, ì•„ë‹ˆë©´ ë©”ì¸ìœ¼ë¡œ
            if("ADMIN".equals(vo.getRole())) {
                url = "redirect:AdminServlet?command=admin_main";
            } else {
                url = "redirect:index.jsp";
            }
        } else if (result == 0) {
            request.setAttribute("message", "ë¹„ë°€ë²ˆí˜¸ê°€ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        } else if (result == -1) {
            request.setAttribute("message", "ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.");
        }

        return url;
    }
}
```

---

## 2. ï¿½ `JoinAction.java` êµ¬í˜„ (íšŒì›ê°€ì…)

ì´ íŒŒì¼ë„ ë¹„ì–´ìˆì„ ê²ƒì…ë‹ˆë‹¤. `web-study-09`ì˜ `JoinServlet` ë¡œì§ì„ ê°€ì ¸ì™€ì„œ ì•„ë˜ì™€ ê°™ì´ ë§Œë“œì„¸ìš”.

**í•µì‹¬ ë³€ê²½ì **:
- `role` íŒŒë¼ë¯¸í„° ì²˜ë¦¬ ì¶”ê°€ (ê´€ë¦¬ì ê°€ì… ê°€ëŠ¥ì„± ì—´ì–´ë‘ê¸°, ê¸°ë³¸ì€ MEMBER)

```java
package com.saeyan.controller.action.member;

import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import com.saeyan.controller.action.Action;
import com.saeyan.dao.MemberDAO;
import com.saeyan.dto.MemberVO;

public class JoinAction implements Action {

    @Override
    public String execute(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
            
        String url = "member/login.jsp"; // ê°€ì… ì„±ê³µ ì‹œ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ

        MemberVO vo = new MemberVO();
        vo.setId(request.getParameter("id"));
        vo.setPassword(request.getParameter("pwd"));
        vo.setName(request.getParameter("name"));
        vo.setEmail(request.getParameter("email"));
        vo.setPhone(request.getParameter("phone"));
        
        // roleì€ ì…ë ¥ ì•ˆ ë°›ìœ¼ë©´ ê¸°ë³¸ê°’ "MEMBER" (DAOì—ì„œ ì²˜ë¦¬í•˜ê±°ë‚˜ ì—¬ê¸°ì„œ ì„¤ì •)
        // ë§Œì•½ ê´€ë¦¬ì ê°€ì… í˜ì´ì§€ë¥¼ ë”°ë¡œ ë§Œë“ ë‹¤ë©´ request.getParameter("role") ì‚¬ìš©
        vo.setRole("MEMBER"); 

        MemberDAO dao = MemberDAO.getInstance();
        dao.insertMember(vo);

        return url;
    }
}
```

---

## 3. âœ… `MemberDAO.java` í™•ì¸

ì´ë¯¸ `role` ê´€ë ¨ ì½”ë“œê°€ ë“¤ì–´ê°€ ìˆëŠ” ê²ƒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ **í•œ ë²ˆ ë” ì²´í¬**í•´ì£¼ì„¸ìš”.

- `getMember(String id)` ë©”ì„œë“œì—ì„œ `rs.getString("role")`ì„ í•˜ê³  ìˆë‚˜ìš”?
- `insertMember(MemberVO vo)` ë©”ì„œë“œì—ì„œ `role` ì»¬ëŸ¼ì„ insert í•˜ê³  ìˆë‚˜ìš”?

ì´ ë¶€ë¶„ì´ ë¹ ì ¸ìˆìœ¼ë©´ ë¡œê·¸ì¸í•´ë„ `userRole`ì´ `null`ì´ ë˜ì–´ ê´€ë¦¬ì í˜ì´ì§€ì— ëª» ë“¤ì–´ê°‘ë‹ˆë‹¤.

---

## 4. ğŸ“ `ActionFactory` ë“±ë¡

ìƒˆë¡œ ë§Œë“  Actionë“¤ì„ `ActionFactory`ì— ë“±ë¡í•´ì•¼ ì‘ë™í•©ë‹ˆë‹¤.

```java
// ActionFactory.javaì˜ getAction ë©”ì„œë“œ ë‚´ë¶€
if (command.equals("login")) {
    action = new LoginAction();
} else if (command.equals("join")) {
    action = new JoinAction();
}
// ... ë‚˜ë¨¸ì§€ ì»¤ë§¨ë“œë“¤ë„ ì—°ê²°
```

í•˜ì˜ë‹˜ì˜ ì‘ì—…ì´ ëë‚˜ì•¼ ë‹¤ë¥¸ íŒ€ì›ë“¤ì´ ë¡œê·¸ì¸ì„ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. **LoginAction**ë¶€í„° ìš°ì„ ì ìœ¼ë¡œ ì²˜ë¦¬í•´ì£¼ì„¸ìš”!
